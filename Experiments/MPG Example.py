# Module Example
# Abraham Oliver, 2016
# Reverse Learning

import numpy as np
from random import randint, random
from csv import reader as CSV

def getMPGDataset():
    # Prepare Data
    data = {"mpg": [], "cylinders": [], "displacement": [], "horsepower": [], "weight": [],
            "acceleration": [], "model_year": [], "origin": [], "car_name": []}
    with open("C:/Users/abeol/Git/ReverseLearning/DataSets/auto-mpg.tab") as tsv:
        reader = CSV(tsv, dialect="excel-tab")
        for line in reader:
            if reader.line_num not in [1, 2, 3] and "?" not in line:
                data["mpg"].append(line[0])
                data["cylinders"].append(line[1])
                data["displacement"].append(line[2])
                data["horsepower"].append(line[3])
                data["weight"].append(line[4])
                data["acceleration"].append(line[5])
                data["model_year"].append(line[6])
                data["origin"].append(line[7])
                data["car_name"].append(line[8])
    # Data in training format
    xs = []
    ys = []
    for i in range(len(data["mpg"])):
        # Inputs
        t = [float(data["cylinders"][i]), float(data["displacement"][i]), float(data["horsepower"][i]),
             float(data["weight"][i]), float(data["acceleration"][i])]
        xs.append(t)
        # Label
        ys.append(float(data["mpg"][i]))
    # Final set
    trainingData = [xs, ys]
    return trainingData

mpgData = getMPGDataset()

import sklearn as skl
from sklearn.neural_network import MLPRegressor
from sklearn.preprocessing import StandardScaler
scaler = StandardScaler()
scaler.fit(mpgData[0])
XTrain = scaler.transform(mpgData[0])

def getRegressor(hidden = ()):
    reg = MLPRegressor(hidden_layer_sizes = hidden,
                       activation = "relu",
                       learning_rate = "constant",
                       learning_rate_init = .01,
                       solver = "lbfgs",
                       verbose = False,
                       max_iter = 10000000,
                       tol = 1e-40)
    reg.fit(XTrain, mpgData[1])
    return reg

best = None
bestAccuracy = 0.0

def getAccuracy(regress):
    r = regress
    runner = 0.0
    for i in range(len(mpgData[0])):
        y_ = int(round(r.predict([XTrain[i]])[0]))
        if y_ in [mpgData[1][i] - 1, mpgData[1][i], mpgData[1][i] + 1]: runner += 1
    return runner / len(mpgData[0])

# for qq in range(6, 8):
qq = 60
r = getRegressor((100, 50))
# Find accuracy
acc = getAccuracy(r)
print("Accuracy w/ H{0} :: {1}".format(qq, acc))
if acc > bestAccuracy:
    bestAccuracy = acc
    best = r
    print("BEST ^^^^^^")

print(best.coefs_)
print(best.intercepts_)
print(best.loss_)

"""
100, 50 Hidden, 63.5%
[array([[  1.10014521e+00,   5.51634829e-01,   1.24523537e+00,
         -1.02085134e+00,  -1.83975364e+00,  -3.84175626e-01,
          1.15876633e+00,  -1.01620845e+00,  -1.38526982e+00,
         -2.95103487e-01,   3.33140645e-01,  -2.92155758e-01,
          2.39542495e-01,  -2.16433885e-01,   3.86989919e-01,
          6.80519140e-01,   1.11466505e+00,   2.05803658e+00,
          1.79453743e-01,  -6.66715406e-01,  -2.75307486e-01,
          6.07155475e-01,  -2.69085877e+00,   8.10149332e-01,
          1.35778710e+00,  -7.87485903e-01,   4.46150847e-01,
         -1.18620650e+00,   2.89065179e-01,   1.39100865e+00,
          3.72164596e-01,   1.00188006e+00,   1.76328829e+00,
          8.90311341e-01,  -7.65398397e-01,   2.75519514e+00,
          1.07752081e+00,   4.88147047e-01,  -9.57892720e-01,
          1.91062487e-01,  -8.13973489e-01,   1.49330660e+00,
          8.40810915e-01,  -4.99122861e-01,   4.86410638e-02,
         -5.93882338e-01,  -8.35095161e-02,  -1.17856871e+00,
          4.52575688e-01,   4.60859604e-01,   1.45253514e+00,
         -1.16298129e+00,  -1.30511002e+00,   3.90782023e-01,
         -6.56172440e-02,  -2.89219727e+00,  -5.38638405e-01,
          4.05570258e-01,  -5.97067720e-01,   3.02702873e+00,
         -1.06220394e+00,   1.30870351e-02,  -6.49009192e-01,
          1.26934601e+00,  -8.37255433e-01,   3.46851426e-01,
          3.90923006e-01,   5.39294380e-01,  -3.98753841e-02,
         -2.95566368e-01,   5.50247684e-01,   2.88746489e-01,
         -3.99132429e-04,  -4.78613183e-01,  -5.00498455e-01,
          5.86711773e-01,   2.60934348e-01,  -2.48089227e-02,
          6.13631439e-02,  -1.30293246e+00,   7.17176110e-01,
          7.37977940e-01,   1.02367971e+00,   6.75119484e-01,
         -3.26706302e-01,  -5.98654149e-01,  -9.15198318e-01,
         -1.62683187e-01,   1.00564394e-02,  -1.82448509e-02,
         -1.49650801e-01,  -9.92366647e-01,  -5.00657318e-01,
         -7.89001988e-01,   1.16043961e+00,   9.99703783e-01,
          4.10639663e-01,   7.44311530e-01,   6.59260626e-01,
          4.10958545e-02],
       [  5.25403810e-01,   2.00878986e-01,  -1.49086942e-01,
         -6.15381553e-01,  -7.21356031e-01,   2.17551195e-01,
          5.51798417e-01,  -3.61604696e-01,   6.44808572e-01,
          1.33747054e+00,   2.51132522e-01,   2.35406884e+00,
         -3.19071044e-01,   3.03963866e-01,  -3.41376858e+00,
          5.54655903e-01,   6.07286861e-02,   1.20596627e+00,
          2.44832491e+00,  -2.89645222e+00,   1.22597641e+00,
         -9.64392676e-02,  -1.00930493e+00,   5.74176464e-01,
          3.27481852e-01,  -1.24056390e+00,   1.72035809e+00,
         -1.03460932e+00,   1.81224895e+00,   2.58436524e+00,
          1.55553411e+00,   2.05407847e-01,   6.87610066e-01,
          9.05753003e-01,   6.02279284e-02,   7.86320119e-01,
          9.69307729e-01,  -7.33333863e-01,  -4.73223456e+00,
         -1.40614689e+00,   1.54894568e+00,   6.04403013e-01,
         -2.24555709e+00,   2.52965190e-02,  -7.23419971e-02,
         -2.81047278e-02,  -7.12168749e-01,  -3.04508020e+00,
          1.03411307e+00,   9.31192217e-01,  -4.45788518e-01,
          1.38696744e+00,  -3.28944910e+00,   3.85022267e-01,
         -3.88484598e-02,  -9.49042868e-01,  -3.38120105e-01,
          1.14016679e+00,   1.37055855e-01,   6.89491435e-01,
         -1.23070770e+00,  -1.94671129e-01,   6.95899113e-01,
          1.24435548e+00,   4.30904529e-01,  -2.93449431e-01,
          5.92243179e-01,  -1.29745503e+00,  -1.66336281e+00,
          7.15997952e-01,   6.66400689e-01,   5.86856683e-01,
         -2.93356652e-02,   9.65484176e-01,   6.07767852e-01,
          8.06718428e-01,   1.10529098e+00,   5.97235607e-01,
         -9.90789811e-01,  -1.97189582e+00,   4.01068585e-01,
         -2.37453897e-01,   1.08479024e+00,  -9.52674793e-01,
         -9.15265762e-01,  -6.17118646e-01,  -1.19518986e+00,
          4.47664886e-01,   9.23545961e-01,  -5.02741770e+00,
          8.52125366e-02,  -6.01033240e-01,   2.54220558e-01,
         -1.74436505e+00,   1.72728443e+00,   3.82569919e+00,
          1.21515104e-01,   8.64473959e-01,   1.61867342e-01,
          1.09519916e+00],
       [ -1.10553338e+00,   9.96660192e-01,  -1.67316473e+00,
         -9.98637186e-01,  -2.32594787e-01,  -4.09423834e+00,
         -1.96000980e-01,   2.41806803e-01,   1.30044019e+00,
         -2.48806458e+00,   4.72085793e-01,  -1.44788473e+00,
          1.32389871e+00,  -3.88074822e+00,   5.17000682e-01,
          8.88082821e-01,  -6.78697463e-02,  -1.49252452e+00,
          7.03012547e-01,  -4.50825762e-01,  -1.30173391e+00,
          5.22938607e-01,   2.87390334e+00,   8.33396306e-01,
         -1.86554347e+00,  -1.26899186e+00,  -8.91060475e-01,
         -3.81951091e-02,  -1.24279992e+00,   2.48370023e-02,
         -2.39116779e+00,   6.40510990e-01,  -1.16186606e+00,
          4.46785721e-01,  -3.94999697e+00,  -8.84935382e-01,
         -2.03415923e+00,  -1.52428369e-01,   2.13240321e+00,
         -8.54262168e-01,   9.14770292e-01,  -1.52292310e+00,
         -8.03562428e-01,  -2.13711238e-01,  -1.53161692e-01,
         -1.23259575e+00,   6.71203394e-02,   2.08265260e-01,
          6.94037108e-01,  -1.83624422e-01,  -3.00753517e+00,
          1.55961182e-01,   3.87728551e-01,   4.40697952e-01,
         -6.47418693e-01,   2.70422327e+00,  -1.05213980e+00,
          8.22635109e-01,  -1.34663451e+00,   5.25364728e-01,
          9.11947570e-01,  -2.54614225e+00,   7.11228454e-01,
         -2.44758895e+00,  -2.81378206e+00,   1.38931771e+00,
          4.82314893e-01,  -5.08531709e-01,  -5.98339981e-01,
          3.13926146e-01,   6.24581072e-01,   1.37685752e-02,
          9.95025272e-01,  -6.53841701e-01,   6.41840988e-01,
          6.93255589e-01,   2.16157343e+00,   6.62197012e-01,
         -9.24181255e-01,  -1.38908420e+00,  -6.49977719e-01,
         -1.39148451e+00,  -4.07050441e+00,   8.41367089e-01,
         -3.35300068e-01,   2.12628816e-01,  -4.02925760e-01,
         -1.13664938e+00,  -3.32529150e-01,   5.98834307e-02,
          2.38552965e-02,   2.33912465e-01,  -4.74917514e-01,
         -1.18251092e+00,  -2.58665842e+00,  -1.83997250e+00,
         -8.47761814e-02,   6.64390735e-01,  -5.88086825e-01,
         -2.77649462e+00],
       [ -7.25318377e-01,   2.99971269e-01,  -1.53499932e+00,
         -2.53259359e-01,  -2.08127592e-01,   1.27420829e-02,
          4.87777807e-01,  -5.54672912e-01,   8.38601775e-01,
         -3.90551526e-01,  -1.59782875e+00,   3.21191593e-01,
          2.47161485e-01,   5.95011244e-01,  -1.52536510e-02,
          2.53390020e-02,  -1.29613228e+00,  -9.13115691e-01,
         -8.68679032e-01,   1.42699513e+00,   5.59719989e-01,
         -5.75586545e-01,   1.62755019e+00,   7.10966474e-02,
          2.01551477e-02,  -3.70716560e-01,   1.99543108e+00,
         -1.43167459e+00,  -1.19304966e-01,  -5.30284235e-01,
         -1.40173774e-01,   1.07702178e-01,   7.41693843e-01,
         -1.35694363e+00,  -1.01717087e-01,  -2.21084247e+00,
          4.28872549e-01,   7.98342068e-01,   2.67800294e-01,
         -1.43789823e+00,  -1.33364191e+00,   2.20009152e-01,
         -1.08573633e+00,   1.21545401e-01,   6.67992839e-02,
         -8.96696945e-01,   2.10643525e-01,   1.75345875e+00,
          6.52981610e-01,  -4.47805784e-03,   5.02345215e-01,
          4.18734028e-01,   8.09037613e-01,   1.17553058e-01,
          4.61040688e-01,  -2.14441051e-01,   1.84725729e-01,
         -6.51914263e-01,   1.74691098e-03,   1.46887303e+00,
          1.94816678e+00,   9.02724166e-01,   8.91155206e-01,
         -3.64239157e-01,  -1.61945621e+00,   3.41287320e-01,
          6.78934859e-01,  -1.98795295e-01,   2.16647087e-01,
          1.63199091e+00,  -5.34088917e-02,   1.93791360e-02,
         -1.92450707e-01,  -4.91309453e-02,   9.81778615e-02,
         -6.73697163e-02,  -6.77573455e-01,  -6.49548748e-01,
          1.79258837e-01,  -7.67101588e-01,  -7.61386375e-01,
         -1.36818453e+00,  -2.34163851e-01,   1.94467856e-01,
          6.30519683e-01,  -1.45331933e-01,  -1.03996716e-01,
          1.39638888e+00,   6.44460153e-01,   1.21029424e+00,
          1.19458317e-01,  -1.16958140e+00,   9.35442725e-01,
         -8.18989358e-01,   2.04061684e-01,  -5.60708119e-01,
          1.08270693e+00,  -2.46811424e-01,  -9.07032133e-01,
          4.11846050e-01],
       [ -2.06441842e-02,   4.93155324e-03,   7.64695083e-01,
         -7.90788325e-01,  -1.50807437e+00,   2.89424835e+00,
          1.38564390e+00,  -1.43944258e+00,  -1.00438957e+00,
          1.67615260e+00,   1.24274311e+00,  -1.82752639e+00,
         -1.09310457e+00,  -6.95879786e-01,   2.55980610e-02,
         -4.56761850e-01,  -1.90172027e+00,   9.52794180e-01,
         -2.51169377e+00,  -1.68564088e+00,  -4.38532782e-01,
          1.76198189e+00,  -3.49365709e-01,  -4.30602975e-01,
         -3.75754296e-01,   4.37726025e-01,   1.08924357e+00,
         -1.85505081e+00,  -2.09061566e+00,  -1.47038652e+00,
          3.75893172e-01,  -3.94899108e-01,   1.53849604e+00,
          8.36120161e-01,   6.15093445e-02,   3.30615782e-01,
          6.83633526e-01,  -1.84813741e+00,  -7.91506796e-01,
          8.44470529e-01,   2.44958177e+00,  -2.08202013e-01,
          6.32957894e-01,  -3.05482390e-01,  -3.86012046e-02,
         -9.32139635e-01,  -1.32815893e+00,   1.03187810e+00,
          3.28377009e-01,  -6.23373453e-01,   7.74653732e-01,
         -1.96736527e+00,  -1.97257866e+00,  -2.46078081e-01,
         -4.23016613e-02,   2.14385537e-01,   2.75310178e-01,
         -1.14461948e-01,   1.87355204e+00,  -3.79067056e-01,
          1.08706301e-03,   3.11342677e-01,  -1.65645081e+00,
         -1.29468084e+00,   5.39355256e-01,  -3.07272868e-01,
          3.99513871e-01,   9.44414037e-01,   1.80972079e+00,
         -1.43910894e+00,  -3.24161908e-01,  -4.67923089e-01,
          2.02450656e+00,  -2.02268497e+00,   5.02476558e-01,
         -1.33821369e+00,   4.54829162e-01,   1.22473558e-01,
         -4.65629032e-01,  -3.43814497e-01,   5.45784653e-01,
          1.30539023e-01,   3.86026306e-01,   2.00286159e+00,
         -7.55791579e-01,   1.60099506e+00,   1.95373337e-01,
          7.55358208e-01,  -8.37996302e-01,   1.40027224e+00,
          9.85837015e-02,  -6.24781275e-01,  -1.16987761e+00,
          1.23433125e+00,  -1.80463477e+00,  -7.12520134e-01,
          8.77658799e-01,   2.58428763e-01,   1.69803571e+00,
          1.77587377e+00]]), array([[ 0.07701381,  0.01965916, -0.01912114, ..., -0.19615868,
        -0.52047937, -0.28872857],
       [-0.13929311,  0.05468705,  0.00633902, ..., -0.31045581,
        -0.30983643, -0.04717618],
       [-0.07389469,  0.05383201, -0.09015516, ..., -0.51527021,
         0.0339888 , -0.22730072],
       ...,
       [-0.28260949, -0.07452049,  0.00549983, ..., -0.50971813,
        -0.30875631, -0.13312292],
       [ 0.27228818, -0.12784328, -0.08874584, ...,  0.45219752,
         0.39501502, -0.14197066],
       [-0.53339985,  0.27579608,  0.02214705, ...,  0.12782107,
        -0.89211854, -0.2307594 ]]), array([[ 1.31776473],
       [-2.78961073],
       [-0.15942974],
       [ 0.04272279],
       [-0.3994208 ],
       [-1.82346808],
       [-0.06295185],
       [ 0.19691235],
       [ 0.1903849 ],
       [ 7.66915376],
       [ 2.64327978],
       [ 0.31557287],
       [ 0.66133039],
       [ 0.88087502],
       [ 0.86196091],
       [ 6.32843376],
       [-2.16515811],
       [ 3.45311259],
       [ 0.12829781],
       [ 4.6459936 ],
       [ 0.07868984],
       [ 3.02183076],
       [ 2.08284503],
       [-0.32945274],
       [ 1.59198077],
       [-0.23716001],
       [-0.62683554],
       [-0.86906397],
       [ 1.08769059],
       [ 0.52256523],
       [-1.74338785],
       [-0.51402595],
       [-0.08981695],
       [-0.08238063],
       [-2.60741124],
       [-0.17813559],
       [-2.00503598],
       [-0.14824005],
       [ 0.15392559],
       [-0.12893213],
       [-0.55460797],
       [ 1.00447324],
       [-0.06160265],
       [-0.24881286],
       [ 6.0434486 ],
       [-0.14273012],
       [ 0.31221779],
       [ 4.17223783],
       [ 1.95412188],
       [ 0.37824477]])]
[array([ 0.92523805, -1.04898428,  0.28805819, -1.7134249 , -0.8252685 ,
       -0.4594639 ,  0.18194957,  2.07341595,  0.53919601,  2.01987135,
       -0.63763896,  2.52676863, -1.19734242,  0.04614433, -2.47606707,
       -1.84277986,  1.884463  ,  0.57935001,  2.19274318, -0.91765165,
       -0.52543567,  1.00163234,  1.46341109, -1.34741711,  1.76738317,
        0.37328668,  1.91031863,  2.20812366, -1.32478973,  0.89947858,
        1.14337934, -0.74707454, -0.52876653, -0.74173029, -0.95689868,
        1.75589814, -1.00505841, -0.1475236 , -3.57369707, -1.54201017,
       -1.3579309 ,  0.26889153, -3.61739342, -0.90568718, -0.14094186,
        0.31921084, -0.7254024 ,  2.86361605,  0.0178401 , -1.02851608,
       -0.64799648, -0.53673947,  2.92336521, -0.71450206,  0.82895303,
       -0.05049025,  0.69198527,  0.05084804,  2.08495799,  0.68864016,
       -0.7798876 , -3.56100667,  0.37581007,  0.5103011 , -0.37758653,
       -0.51247451, -0.09196422,  2.09362303,  0.47082352,  1.23689752,
       -1.45531358, -0.53167688,  0.99617421,  3.53807138, -0.923977  ,
       -2.6657147 , -0.54679897, -0.66395105, -0.85741865,  3.02032638,
       -1.20312442, -1.40704937, -1.73614643, -1.50505004,  2.40186466,
       -1.33480508,  1.01553461, -2.69257677, -1.23880266, -1.46818393,
       -0.32112063,  1.50866476,  1.9525336 , -0.2571322 ,  3.12540715,
       -3.00917292, -1.1809736 ,  0.79504559,  0.48069883,  0.53070923]), array([ 0.12037235, -0.36232712,  0.04470071, -0.22959745,  0.03188612,
        0.19298204, -0.09251754, -0.27640951, -0.17228512,  0.33655651,
        0.2485857 ,  0.14249193,  0.43822236, -0.07498729,  0.27910894,
        0.03762307,  0.42902844,  0.16127098, -0.06050961,  0.27865675,
       -0.17893625,  0.03982368,  0.63380703,  0.04872098,  0.21538207,
       -0.36304698,  0.33361746,  0.18935387, -0.18516345, -0.28442521,
        0.54302368, -0.41043917, -0.129778  ,  0.11324649,  0.44732329,
       -0.20025235,  0.51471038, -0.06302989, -0.27983028, -0.1772513 ,
       -0.20481534,  0.09226216, -0.34578268, -0.01198618,  0.50107118,
       -0.19265729, -0.17935634,  0.38503244,  0.25394343, -0.44279204]), array([ 1.45793125])]"""
